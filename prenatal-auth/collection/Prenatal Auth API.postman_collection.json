{
	"info": {
		"_postman_id": "9931f394-f2bc-424f-bd7c-97d7735834bf",
		"name": "Prenatal Auth API",
		"description": "Collection para testar a API de autenticação do sistema Prenatal Digital SUS",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "12426144"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Verificar Status da API",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"actuator",
								"health"
							]
						},
						"description": "Verifica o status de saúde da aplicação. Não requer autenticação."
					},
					"response": []
				}
			]
		},
		{
			"name": "Autenticação",
			"item": [
				{
					"name": "Obter Token OAuth2 Paciente",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Gera Basic Auth token automaticamente",
									"const clientId = pm.environment.get(\"client_id\");",
									"const clientSecret = pm.environment.get(\"client_secret\");",
									"const basicAuth = btoa(clientId + \":\" + clientSecret);",
									"pm.environment.set(\"basic_auth_token\", basicAuth);",
									"console.log(\"Basic Auth token gerado automaticamente\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"Token salvo: \" + jsonData.access_token);",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "myclientsecret",
									"type": "string"
								},
								{
									"key": "username",
									"value": "myclientid",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							},
							{
								"key": "Authorization",
								"value": "Basic {{basic_auth_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "maria.silva@tuamaeaquelaursa.com",
									"type": "text"
								},
								{
									"key": "password",
									"value": "senha123",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "read write",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/oauth2/token",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"oauth2",
								"token"
							]
						},
						"description": "Obtém token OAuth2 para o paciente Maria da Silva (email: maria.silva@tuamaeaquelaursa.com). O token é salvo em 'access_token'."
					},
					"response": []
				},
				{
					"name": "Obter Token OAuth2 Enfermeira",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const clientId = pm.environment.get(\"client_id\");",
									"const clientSecret = pm.environment.get(\"client_secret\");",
									"const basicAuth = btoa(clientId + \":\" + clientSecret);",
									"pm.environment.set(\"basic_auth_token\", basicAuth);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "basic", "basic": [ { "key": "password", "value": "myclientsecret", "type": "string" }, { "key": "username", "value": "myclientid", "type": "string" } ] },
						"method": "POST",
						"header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" }, { "key": "Authorization", "value": "Basic {{basic_auth_token}}", "type": "text" } ],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{ "key": "grant_type", "value": "password", "type": "text" },
								{ "key": "username", "value": "ana.costa@tuamaeaquelaursa.com", "type": "text" },
								{ "key": "password", "value": "senha123", "type": "text" },
								{ "key": "scope", "value": "read write", "type": "text" }
							]
						},
						"url": { "raw": "{{base_url}}/oauth2/token", "host": ["{{base_url}}"], "path": ["oauth2", "token"] },
						"description": "Obtém token OAuth2 para a enfermeira Ana Costa (email: ana.costa@tuamaeaquelaursa.com). O token é salvo em 'access_token'."
					},
					"response": []
				},
				{
					"name": "Obter Token OAuth2 Medico",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const clientId = pm.environment.get(\"client_id\");",
									"const clientSecret = pm.environment.get(\"client_secret\");",
									"const basicAuth = btoa(clientId + \":\" + clientSecret);",
									"pm.environment.set(\"basic_auth_token\", basicAuth);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "basic", "basic": [ { "key": "password", "value": "myclientsecret", "type": "string" }, { "key": "username", "value": "myclientid", "type": "string" } ] },
						"method": "POST",
						"header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" }, { "key": "Authorization", "value": "Basic {{basic_auth_token}}", "type": "text" } ],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{ "key": "grant_type", "value": "password", "type": "text" },
								{ "key": "username", "value": "pedro.souza@tuamaeaquelaursa.com", "type": "text" },
								{ "key": "password", "value": "senha123", "type": "text" },
								{ "key": "scope", "value": "read write", "type": "text" }
							]
						},
						"url": { "raw": "{{base_url}}/oauth2/token", "host": ["{{base_url}}"], "path": ["oauth2", "token"] },
						"description": "Obtém token OAuth2 para o médico Dr. Pedro Souza (email: pedro.souza@tuamaeaquelaursa.com). O token é salvo em 'access_token'."
					},
					"response": []
				}
			]
		},
		{
			"name": "Usuários",
			"item": [
				{
					"name": "Criar Usuário Paciente",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"Maria da Silva\",\n    \"email\": \"maria.silva@tuamaeaquelaursa.com\",\n    \"login\": \"maria.silva\",\n    \"cpf\": \"12345678900\",\n    \"senha\": \"senha123\",\n    \"perfil\": \"ROLE_PATIENT\",\n    \"endereco\": {\n        \"rua\": \"R. Maria Marciana Dos Santos, Zona Rural Capão\",\n        \"numero\": 628,\n        \"cidade\": \"Nova Serrana\",\n        \"estado\": \"MG\",\n        \"cep\": \"35519-000\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios"
							]
						},
						"description": "Cria um novo usuário paciente no sistema. CPF obrigatório (11 dígitos)."
					},
					"response": []
				},
				{
					"name": "Criar Usuário Enfermeira",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"Ana Costa\",\n    \"email\": \"ana.costa@tuamaeaquelaursa.com\",\n    \"login\": \"ana.costa\",\n    \"cpf\": \"12345678902\",\n    \"senha\": \"senha123\",\n    \"perfil\": \"ROLE_NURSE\",\n    \"endereco\": {\n        \"rua\": \"R. Maria Marciana Dos Santos, Zona Rural Capão\",\n        \"numero\": 628,\n        \"cidade\": \"Nova Serrana\",\n        \"estado\": \"MG\",\n        \"cep\": \"35519-000\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios"
							]
						},
						"description": "Cria um novo usuário enfermeira (ROLE_NURSE). CPF obrigatório (11 dígitos). Use o token de um usuário já existente (ex.: médico ou admin) para criar."
					},
					"response": []
				},
				{
					"name": "Criar Usuário Medico",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"Dr. Pedro Souza\",\n    \"email\": \"pedro.souza@tuamaeaquelaursa.com\",\n    \"login\": \"pedro.souza\",\n    \"cpf\": \"12345678903\",\n    \"senha\": \"senha123\",\n    \"perfil\": \"ROLE_DOCTOR\",\n    \"endereco\": {\n        \"rua\": \"R. Maria Marciana Dos Santos, Zona Rural Capão\",\n        \"numero\": 628,\n        \"cidade\": \"Nova Serrana\",\n        \"estado\": \"MG\",\n        \"cep\": \"35519-000\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios"
							]
						},
						"description": "Cria um novo usuário médico (ROLE_DOCTOR). CPF obrigatório (11 dígitos). Para o primeiro médico, use um token de usuário criado via migration/seed ou crie-o sem auth se a API permitir em dev."
					},
					"response": []
				},
				{
					"name": "Buscar Usuário por ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}"
							]
						},
						"description": "Busca um usuário específico pelo seu ID"
					},
					"response": []
				},
				{
					"name": "Atualizar Usuário",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"João Silva Atualizado\",\n    \"email\": \"joao.silva.updated@example.com\",\n    \"login\": \"joao.silva.updated\",\n    \"senha\": \"novaSenha123\",\n    \"perfil\": \"ROLE_PATIENT\",\n    \"endereco\": {\n        \"rua\": \"Rua das Flores Atualizada\",\n        \"numero\": 456,\n        \"cidade\": \"São Paulo\",\n        \"estado\": \"SP\",\n        \"cep\": \"01234-567\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}"
							]
						},
						"description": "Atualiza os dados de um usuário existente"
					},
					"response": []
				},
				{
					"name": "Atualizar Senha",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"senha\": \"novaSenhaSegura123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}/senha",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}",
								"senha"
							]
						},
						"description": "Atualiza a senha de um usuário específico"
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8079",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "myclientid",
			"type": "string"
		},
		{
			"key": "client_secret",
			"value": "myclientsecret",
			"type": "string"
		},
		{
			"key": "username",
			"value": "",
			"type": "string"
		},
		{
			"key": "password",
			"value": "",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "1",
			"type": "string"
		},
		{
			"key": "basic_auth_token",
			"value": "",
			"type": "string",
			"description": "Token Basic Auth gerado automaticamente (client_id:client_secret em base64)"
		}
	]
}