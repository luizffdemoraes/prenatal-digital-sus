{
	"info": {
		"_postman_id": "prenatal-auth-collection",
		"name": "Prenatal Auth API",
		"description": "Collection para testar a API de autenticação do sistema Prenatal Digital SUS",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Verificar Status da API",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"actuator",
								"health"
							]
						},
						"description": "Verifica o status de saúde da aplicação. Não requer autenticação."
					},
					"response": []
				}
			]
		},
		{
			"name": "Autenticação",
			"item": [
				{
					"name": "Obter Token OAuth2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Gera Basic Auth token automaticamente",
									"const clientId = pm.environment.get(\"client_id\");",
									"const clientSecret = pm.environment.get(\"client_secret\");",
									"const basicAuth = btoa(clientId + \":\" + clientSecret);",
									"pm.environment.set(\"basic_auth_token\", basicAuth);",
									"console.log(\"Basic Auth token gerado automaticamente\");"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.environment.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"Token salvo: \" + jsonData.access_token);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							},
							{
								"key": "Authorization",
								"value": "Basic {{basic_auth_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "{{username}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "{{password}}",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "read write",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/oauth2/token",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"oauth2",
								"token"
							]
						},
						"description": "Obtém um token de acesso OAuth2 usando o grant type 'password'. O token será automaticamente salvo na variável de ambiente 'access_token'."
					},
					"response": []
				}
			]
		},
		{
			"name": "Usuários",
			"item": [
				{
					"name": "Criar Usuário",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"João Silva\",\n    \"email\": \"joao.silva@example.com\",\n    \"login\": \"joao.silva\",\n    \"senha\": \"senha123\",\n    \"perfil\": \"ROLE_PATIENT\",\n    \"endereco\": {\n        \"rua\": \"Rua das Flores\",\n        \"numero\": 123,\n        \"cidade\": \"São Paulo\",\n        \"estado\": \"SP\",\n        \"cep\": \"01234-567\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios"
							]
						},
						"description": "Cria um novo usuário no sistema. Os perfis disponíveis são: ROLE_DOCTOR, ROLE_NURSE, ROLE_PATIENT"
					},
					"response": []
				},
				{
					"name": "Buscar Usuário por ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}"
							]
						},
						"description": "Busca um usuário específico pelo seu ID"
					},
					"response": []
				},
				{
					"name": "Atualizar Usuário",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nome\": \"João Silva Atualizado\",\n    \"email\": \"joao.silva.updated@example.com\",\n    \"login\": \"joao.silva.updated\",\n    \"senha\": \"novaSenha123\",\n    \"perfil\": \"ROLE_PATIENT\",\n    \"endereco\": {\n        \"rua\": \"Rua das Flores Atualizada\",\n        \"numero\": 456,\n        \"cidade\": \"São Paulo\",\n        \"estado\": \"SP\",\n        \"cep\": \"01234-567\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}"
							]
						},
						"description": "Atualiza os dados de um usuário existente"
					},
					"response": []
				},
				{
					"name": "Atualizar Senha",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"senha\": \"novaSenhaSegura123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/v1/usuarios/{{user_id}}/senha",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"usuarios",
								"{{user_id}}",
								"senha"
							]
						},
						"description": "Atualiza a senha de um usuário específico"
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8079",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "myclientid",
			"type": "string"
		},
		{
			"key": "client_secret",
			"value": "myclientsecret",
			"type": "string"
		},
		{
			"key": "username",
			"value": "",
			"type": "string"
		},
		{
			"key": "password",
			"value": "",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "1",
			"type": "string"
		},
		{
			"key": "basic_auth_token",
			"value": "",
			"type": "string",
			"description": "Token Basic Auth gerado automaticamente (client_id:client_secret em base64)"
		}
	],
	"auth": {
		"type": "noauth"
	}
}
